;/*FB_PKG_DELIM*/

__d("MWChatEncryptedBackupsDeleteBackupsOnClientDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MWChatEncryptedBackupsDeleteBackupsOnClientNOP").__setRef("MWChatEncryptedBackupsDeleteBackupsOnClientDeferred");function a(a,b){return h.load().then(function(c){return c(a,b)})}g["default"]=a}),98);
__d("LSHandleAutoRestoreRegisterFailure.nop",["MWChatEncryptedBackupsDeleteBackupsOnClientDeferred"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,d){return c("MWChatEncryptedBackupsDeleteBackupsOnClientDeferred")(d,a)};a.__nop_name__="LSHandleAutoRestoreRegisterFailure";g["default"]=a}),98);
__d("MWChatEncryptedBackupsStoreAuthoritativeClientStateDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MWChatEncryptedBackupsStoreAuthoritativeClientStateNOP").__setRef("MWChatEncryptedBackupsStoreAuthoritativeClientStateDeferred");function a(a,b,c,d){return h.load().then(function(e){return e(a,b,c,d)})}g["default"]=a}),98);
__d("LSNativeStoreAuthoritativeClientState.nop",["MWChatEncryptedBackupsStoreAuthoritativeClientStateDeferred"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,d,e,f){return c("MWChatEncryptedBackupsStoreAuthoritativeClientStateDeferred")(d,e,f,a)};a.__nop_name__="LSNativeStoreAuthoritativeClientState";g["default"]=a}),98);
__d("LSOnboardFromExistingDeviceFinish",["LSDeleteBackupOnClient","LSGenerateLocalKeys","LSHandleAutoRestoreRegisterFailure.nop","LSLogMebClientEvent.nop","LSNativeStoreAuthoritativeClientState.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][onboardFromExistingDeviceFinish] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.i64.eq(a[2],c.i64.cast([0,602]))?c.sequence([function(d){return c.nativeOperation(b("LSHandleAutoRestoreRegisterFailure.nop"),a[0])},function(a){return d[9]=new c.Map(),d[9].set("error_code",c.i64.cast([0,602])),d[9].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceFinishStoredProcedure"),d[9].set("error_message",""),d[2]=d[9]}]):c.sequence([function(e){return c.i64.neq(a[0],void 0)?c.sequence([function(e){return c.i64.neq(a[1],void 0)?c.sequence([function(a){return c.storedProcedure(b("LSGenerateLocalKeys"),!0).then(function(a){return a=a,d[11]=a[0],d[12]=a[1],a})},function(e){return d[11]!==void 0?c.sequence([function(a){return c.i64.neq(void 0,void 0)?c.sequence([function(a){return c.count(c.db.table(169).fetch([[[void 0]]])).then(function(a){return d[16]=a})},function(a){return c.i64.le(d[16],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[void 0]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[26]=new c.Map(),d[26].set("error_msg","Expected a nonempty query result"),d[26].set("code",c.i64.cast([0,3])),d[26].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[27]=c.createArray(),d[28]=(d[27].push(d[26]),d[27]),e=[void 0,d[27]],d[22]=e[0],d[23]=e[1],e):(b=a.item,d[26]=new c.Map(),d[26].set("epoch_id",b.epochId),d[26].set("backup_id",b.backupId),d[26].set("epoch_anon_id_blob",b.epochAnonIdBlob),d[26].set("epoch_root_key_blob",b.epochRootKeyBlob),d[26].set("epoch_status",b.epochStatus),d[26].set("epoch_head",b.epochHead),d[26].set("authority_level",b.authorityLevel),e=[d[26],void 0],d[22]=e[0],d[23]=e[1],e)})},function(a){return d[25]=new c.Map(),d[25].set("value",d[22]),d[25].set("errors",d[23]),d[17]=d[25]}]):c.resolve((d[22]=new c.Map(),d[22].set("error_msg","Expected at most one result"),d[22].set("code",c.i64.cast([0,4])),d[22].set("src_line","MEBEpochClientUtils.php:313 MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly()"),d[23]=c.createArray(),d[25]=(d[23].push(d[22]),d[23]),d[24]=new c.Map(),d[24].set("value",void 0),d[24].set("errors",d[23]),d[17]=d[24]))},function(a){return d[18]=d[17].get("value"),d[18]!==void 0?(d[22]=d[18].get("epoch_id"),d[23]=d[18].get("backup_id"),d[24]=d[18].get("epoch_anon_id_blob"),d[25]=d[18].get("epoch_root_key_blob"),d[26]=d[18].get("epoch_status"),d[27]=d[18].get("epoch_head"),d[28]=d[18].get("authority_level"),c.i64.eq(d[28],c.i64.cast([0,80]))?d[29]=d[17]:(d[30]=new c.Map(),d[30].set("error_msg","NONE"),d[30].set("code",c.i64.cast([0,0])),d[30].set("src_line","MEBEpochClientUtils.php:315 Closure$MEBEpochClientUtils::requireEpochReturnShapeFromPersistentEpochsTableDirectly#2()"),d[31]=c.createArray(),d[33]=(d[31].push(d[30]),d[31]),d[32]=new c.Map(),d[32].set("value",void 0),d[32].set("errors",d[31]),d[29]=d[32]),d[19]=d[29]):(d[22]=d[17].get("errors"),d[23]=d[17].get("errors"),d[24]=new c.Map(),d[24].set("value",void 0),d[24].set("errors",d[22]),d[19]=d[24]),d[20]=d[19].get("value"),d[20]!==void 0?(d[22]=d[20].get("epoch_id"),d[23]=d[20].get("backup_id"),d[24]=d[20].get("epoch_anon_id_blob"),d[25]=d[20].get("epoch_root_key_blob"),d[26]=d[20].get("epoch_status"),d[27]=d[20].get("epoch_head"),d[28]=d[20].get("authority_level"),d[21]=!0):(d[22]=d[19].get("errors"),d[23]=d[19].get("errors"),d[21]=!1),d[14]=d[21]}]):c.resolve(d[14]=!0)},function(e){return d[14]?c.sequence([function(e){return c.nativeOperation(b("LSNativeStoreAuthoritativeClientState.nop"),a[0],a[1],d[11]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]!==void 0?(d[18]=d[16].get("error_code"),d[19]=new c.Map(),d[19].set("error_code",d[18]),d[19].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceFinishStoredProcedure"),d[19].set("error_message",""),d[17]=d[19]):(d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,601])),d[18].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceFinishStoredProcedure"),d[18].set("error_message",""),d[17]=d[18]),d[15]=d[17]}]):c.resolve((d[16]=new c.Map(),d[16].set("error_code",c.i64.cast([0,606])),d[16].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceFinishStoredProcedure"),d[16].set("error_message",""),d[15]=d[16]))},function(a){return d[13]=d[15]}]):c.sequence([function(d){return c.nativeOperation(b("LSHandleAutoRestoreRegisterFailure.nop"),a[0])},function(a){return d[12]!==void 0?(d[15]=d[12].get("error_code"),d[16]=new c.Map(),d[16].set("error_code",d[15]),d[16].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceFinishStoredProcedure"),d[16].set("error_message",""),d[14]=d[16]):(d[15]=new c.Map(),d[15].set("error_code",c.i64.cast([0,601])),d[15].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceFinishStoredProcedure"),d[15].set("error_message",""),d[14]=d[15]),d[13]=d[14]}])},function(a){return d[10]=d[13]}]):c.sequence([function(d){return c.storedProcedure(b("LSDeleteBackupOnClient"),a[0],void 0,!0,void 0,void 0,!1)},function(a){return d[11]=new c.Map(),d[11].set("error_code",c.i64.cast([0,24])),d[11].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceFinishStoredProcedure"),d[11].set("error_message",""),d[10]=d[11]}])},function(a){return d[9]=d[10]}]):c.sequence([function(d){return c.storedProcedure(b("LSDeleteBackupOnClient"),a[0],void 0,!0,void 0,void 0,!1)},function(a){return d[10]=new c.Map(),d[10].set("error_code",c.i64.cast([0,1])),d[10].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceFinishStoredProcedure"),d[10].set("error_message",""),d[9]=d[10]}])},function(a){return d[2]=d[9]}])},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][onboardFromExistingDeviceFinish] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"onboardFromExistingDeviceFinish",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[2]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsOnboardFromExistingDeviceFinishStoredProcedure";a.__tables__=["secure_encrypted_backups_epochs"];e.exports=a}),null);